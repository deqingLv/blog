<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <script type="application/javascript" src='https://deqinglv.github.io/blog/js/theme-mode.js'></script>
    <link rel="stylesheet" href='https://deqinglv.github.io/blog/css/frameworks.min.css' />
    <link rel="stylesheet" href='https://deqinglv.github.io/blog/css/github.min.css' />
    <link rel="stylesheet" href='https://deqinglv.github.io/blog/css/github-style.css' />
    <link rel="stylesheet" href='https://deqinglv.github.io/blog/css/light.css' />
    <link rel="stylesheet" href='https://deqinglv.github.io/blog/css/dark.css' />
    <link rel="stylesheet" href='https://deqinglv.github.io/blog/css/syntax.css' />
    <title>LangChain 1.0 React Agent Demo：构建智能推理代理 - 山的下午茶</title>
    
    <link rel="icon" type="image/x-icon" href='https://deqinglv.github.io/blog/images/favicon.ico'>
    
    <meta name="theme-color" content="#1e2327">

    
    

    
    <meta name="description"
  content="基于 LangChain 1.0 版本，使用 Python 开发一个 React（Reasoning and Acting）模式的智能代理 demo，展示如何构建能够推理和行动的 AI Agent" />
<meta name="keywords"
  content='LangChain, React Agent, Python, AI Agent, LLM' />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://deqinglv.github.io/blog/post/langchain-1-agent-demo/" />


<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="LangChain 1.0 React Agent Demo：构建智能推理代理 - 山的下午茶" />
<meta name="twitter:description"
  content="基于 LangChain 1.0 版本，使用 Python 开发一个 React（Reasoning and Acting）模式的智能代理 demo，展示如何构建能够推理和行动的 AI Agent" />
<meta name="twitter:site" content="https://deqinglv.github.io/blog/" />
<meta name="twitter:creator" content="" />
<meta name="twitter:image"
  content="https://deqinglv.github.io/blog/">


<meta property="og:type" content="article" />
<meta property="og:title" content="LangChain 1.0 React Agent Demo：构建智能推理代理 - 山的下午茶">
<meta property="og:description"
  content="基于 LangChain 1.0 版本，使用 Python 开发一个 React（Reasoning and Acting）模式的智能代理 demo，展示如何构建能够推理和行动的 AI Agent" />
<meta property="og:url" content="https://deqinglv.github.io/blog/post/langchain-1-agent-demo/" />
<meta property="og:site_name" content="LangChain 1.0 React Agent Demo：构建智能推理代理" />
<meta property="og:image"
  content="https://deqinglv.github.io/blog/">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta property="article:published_time" content="2025-12-30 15:00:06 &#43;0800 CST" />











</head>


<body>
  <div style="position: relative">
  <header class="Header js-details-container Details px-3 px-md-4 px-lg-5 flex-wrap flex-md-nowrap open Details--on">
    <div class="Header-item mobile-none" style="margin-top: -4px; margin-bottom: -4px;">
      <a class="Header-link" href="https://deqinglv.github.io/blog/">
        <img class="octicon" height="32" width="32" src="images/github-mark-white.png">
      </a>
    </div>
    <div class="Header-item d-md-none">
      <button class="Header-link btn-link js-details-target" type="button"
        onclick="document.querySelector('#header-search').style.display = document.querySelector('#header-search').style.display == 'none'? 'block': 'none'">
        <svg height="24" class="octicon octicon-three-bars" viewBox="0 0 16 16" version="1.1" width="24">
          <path fill-rule="evenodd" d="M1 2.75A.75.75 0 011.75 2h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 2.75zm0 5A.75.75 0 011.75 7h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 7.75zM1.75 12a.75.75 0 100 1.5h12.5a.75.75 0 100-1.5H1.75z">
          </path>
        </svg>
      </button>
    </div>
    <div style="display: none;" id="header-search"
      class="Header-item Header-item--full flex-column flex-md-row width-full flex-order-2 flex-md-order-none mr-0 mr-md-3 mt-3 mt-md-0 Details-content--hidden-not-important d-md-flex">
      <div
        class="Header-search header-search flex-auto js-site-search position-relative flex-self-stretch flex-md-self-auto mb-3 mb-md-0 mr-0 mr-md-3 scoped-search site-scoped-search js-jump-to">
        <div class="position-relative">
          
          <form target="_blank" id="search-form" action="" accept-charset="UTF-8" method="get"
            autocomplete="off">
            <label
              class="Header-search-label form-control input-sm header-search-wrapper p-0 js-chromeless-input-container header-search-wrapper-jump-to position-relative d-flex flex-justify-between flex-items-center">
              <input type="text"
                class="Header-search-input form-control input-sm header-search-input jump-to-field js-jump-to-field js-site-search-focus js-site-search-field is-clearable"
                name="q" value="" placeholder="Search" autocomplete="off">
            </label>
          </form>
          
        </div>
      </div>
    </div>

    <div class="Header-item Header-item--full flex-justify-center d-md-none position-relative">
      <a class="Header-link " href="https://deqinglv.github.io/blog/">
        <img class="octicon octicon-mark-github v-align-middle" height="32" width="32" src="images/github-mark-white.png">
      </a>
    </div>
    <div class="Header-item" style="margin-right: 0;">
      <a href="javascript:void(0)" class="Header-link no-select" onclick="switchTheme()">
        <svg style="fill: var(--color-profile-color-modes-toggle-moon);" class="no-select" viewBox="0 0 16 16"
          version="1.1" width="16" height="16">
          <path fill-rule="evenodd" clip-rule="evenodd"
            d="M4.52208 7.71754C7.5782 7.71754 10.0557 5.24006 10.0557 2.18394C10.0557 1.93498 10.0392 1.68986 10.0074 1.44961C9.95801 1.07727 10.3495 0.771159 10.6474 0.99992C12.1153 2.12716 13.0615 3.89999 13.0615 5.89383C13.0615 9.29958 10.3006 12.0605 6.89485 12.0605C3.95334 12.0605 1.49286 10.001 0.876728 7.24527C0.794841 6.87902 1.23668 6.65289 1.55321 6.85451C2.41106 7.40095 3.4296 7.71754 4.52208 7.71754Z">
          </path>
        </svg>
      </a>
    </div>
  </header>
</div>

  <div id="search-result" class="container-lg px-3 new-discussion-timeline" style="display: none;">
</div>

  
<div class="application-main">
  <div>
  <main>
    <div class="gisthead pagehead bg-gray-light pb-0 pt-3 mb-4">
      <div class="px-0">
        <div class="mb-3 d-flex px-3 px-md-3 px-lg-5">
          <div class="flex-auto min-width-0 width-fit mr-3">
            <div class="d-flex">
              <div class="d-none d-md-block">
                <a class="avatar mr-2 flex-shrink-0" href="https://deqinglv.github.io/blog/">
                  <img class=" avatar-user"
                    src="https://avatars3.githubusercontent.com/u/6064297?s=460&amp;u=59de91a71b664110669fa87ad15110e12e3250ad&amp;v=4"
                    width="32" height="32"></a>
              </div>
              <div class="d-flex flex-column">
                <h1 class="break-word f3 text-normal mb-md-0 mb-1">
                  <span class="author">
                    <a href="https://deqinglv.github.io/blog/">Deqing Lv</a>
                  </span>
                  <span class="path-divider">/</span>
                  <strong class="css-truncate css-truncate-target mr-1" style="max-width: 410px">
                    <a href="https://deqinglv.github.io/blog/post/langchain-1-agent-demo/">LangChain 1.0 React Agent Demo：构建智能推理代理</a>
                  </strong>
                </h1>
                <div class="note m-0">
                  Created <relative-time datetime="Tue, 30 Dec 2025 15:00:06 &#43;0800"
                    class="no-wrap">
                    Tue, 30 Dec 2025 15:00:06 &#43;0800</relative-time>

                  
                  <span class="file-info-divider"></span>
                  Modified <relative-time datetime="Tue, 30 Dec 2025 16:53:46 &#43;0800"
                    class="no-wrap">
                    Tue, 30 Dec 2025 16:53:46 &#43;0800</relative-time>
                  
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="container-lg px-3 new-discussion-timeline">
      <div class="repository-content gist-content">
        <div>
          <div class="js-gist-file-update-container js-task-list-container file-box">
            <div id="file-pytest" class="file my-2">
              <div id="post-header" class="file-header d-flex flex-md-items-center flex-items-start sticky-header" style="z-index: 2">
                <div class="file-info d-flex flex-md-items-center flex-items-start flex-order-1 flex-auto">
                  <div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">
                    
                    <summary id="toc-toggle" onclick="clickToc()" class="btn btn-octicon m-0 mr-2 p-2">
                      <svg aria-hidden="true" viewBox="0 0 16 16" height="16" width="16" class="octicon octicon-list-unordered">
                        <path fill-rule="evenodd" d="M2 4a1 1 0 100-2 1 1 0 000 2zm3.75-1.5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zM3 8a1 1 0 11-2 0 1 1 0 012 0zm-1 6a1 1 0 100-2 1 1 0 000 2z"></path>
                      </svg>
                    </summary>
                    <details-menu class="SelectMenu" id="toc-details" style="display: none;">
                      <div class="SelectMenu-modal rounded-3 mt-1" style="max-height: 340px;">
                        <div class="SelectMenu-list SelectMenu-list--borderless p-2" style="overscroll-behavior: contain;" id="toc-list">
                        </div>
                      </div>
                    </details-menu>
                      3229 Words
                    

                  </div>
                  <div class="file-actions flex-order-2 pt-0">
                    
                  </div>
                </div>
              </div>


              <div class="Box-body px-5 pb-5" style="z-index: 1">
                <article class="markdown-body entry-content container-lg"><h1 id="langchain-10-react-agent-demo构建智能推理代理">LangChain 1.0 React Agent Demo：构建智能推理代理</h1>
<p>LangChain 1.0 版本带来了许多重要的改进和新特性，其中 React（Reasoning and Acting）模式的 Agent 是一个强大的功能。本文将带你从零开始，使用 Python 构建一个完整的 React Agent Demo。</p>
<h2 id="什么是-react-agent">什么是 React Agent？</h2>
<p>React（Reasoning and Acting）是一种结合了推理（Reasoning）和行动（Acting）的 Agent 模式。Agent 会：</p>
<ol>
<li><strong>推理（Reasoning）</strong>：分析问题，思考需要采取什么行动</li>
<li><strong>行动（Acting）</strong>：调用工具执行具体操作</li>
<li><strong>观察（Observing）</strong>：观察工具执行的结果</li>
<li><strong>循环</strong>：基于观察结果继续推理，直到完成任务</li>
</ol>
<p>这种模式让 Agent 能够处理复杂的多步骤任务，通过工具调用来获取信息、执行操作，最终给出答案。</p>
<h2 id="环境准备">环境准备</h2>
<h3 id="1-python-版本要求">1. Python 版本要求</h3>
<p><strong>重要</strong>：LangChain 1.0 要求 Python 版本 <strong>≥ 3.10</strong>。Python 3.9 及以下版本不再支持。</p>
<p>检查你的 Python 版本：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">python --version
</span></span><span class="line"><span class="cl"><span class="c1"># 或</span>
</span></span><span class="line"><span class="cl">python3 --version
</span></span></code></pre></div><p>如果版本低于 3.10，请先升级 Python 版本。</p>
<h3 id="2-安装依赖">2. 安装依赖</h3>
<p>安装必要的 Python 包：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">pip install langchain&gt;<span class="o">=</span>1.0.0
</span></span><span class="line"><span class="cl">pip install langchain-openai
</span></span><span class="line"><span class="cl">pip install langchain-community
</span></span><span class="line"><span class="cl">pip install langchain-experimental
</span></span><span class="line"><span class="cl">pip install langchainhub
</span></span></code></pre></div><h3 id="3-配置环境变量">3. 配置环境变量</h3>
<p>设置你的 DeepSeek API 密钥：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">DEEPSEEK_API_KEY</span><span class="o">=</span><span class="s2">&#34;your-deepseek-api-key-here&#34;</span>
</span></span></code></pre></div><p>如果需要使用搜索工具，还需要设置 Tavily API Key：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">TAVILY_API_KEY</span><span class="o">=</span><span class="s2">&#34;your-tavily-api-key-here&#34;</span>
</span></span></code></pre></div><h2 id="完整代码实现">完整代码实现</h2>
<h3 id="基础版本简单的-react-agent">基础版本：简单的 React Agent</h3>
<p>让我们先创建一个基础的 React Agent：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_openai</span> <span class="kn">import</span> <span class="n">ChatOpenAI</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain.agents</span> <span class="kn">import</span> <span class="n">create_react_agent</span><span class="p">,</span> <span class="n">AgentExecutor</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain</span> <span class="kn">import</span> <span class="n">hub</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_community.tools</span> <span class="kn">import</span> <span class="n">DuckDuckGoSearchRun</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 初始化语言模型（使用 DeepSeek）</span>
</span></span><span class="line"><span class="cl"><span class="n">llm</span> <span class="o">=</span> <span class="n">ChatOpenAI</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span><span class="o">=</span><span class="s2">&#34;deepseek-chat&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">api_key</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&#34;DEEPSEEK_API_KEY&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">base_url</span><span class="o">=</span><span class="s2">&#34;https://api.deepseek.com/v1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 定义工具</span>
</span></span><span class="line"><span class="cl"><span class="n">tools</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="n">DuckDuckGoSearchRun</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 从 LangChain Hub 加载 React prompt</span>
</span></span><span class="line"><span class="cl"><span class="n">prompt</span> <span class="o">=</span> <span class="n">hub</span><span class="o">.</span><span class="n">pull</span><span class="p">(</span><span class="s2">&#34;hwchase17/react&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 创建 React Agent</span>
</span></span><span class="line"><span class="cl"><span class="n">agent</span> <span class="o">=</span> <span class="n">create_react_agent</span><span class="p">(</span><span class="n">llm</span><span class="p">,</span> <span class="n">tools</span><span class="p">,</span> <span class="n">prompt</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 创建 Agent 执行器</span>
</span></span><span class="line"><span class="cl"><span class="n">agent_executor</span> <span class="o">=</span> <span class="n">AgentExecutor</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">agent</span><span class="o">=</span><span class="n">agent</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">handle_parsing_errors</span><span class="o">=</span><span class="kc">True</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 运行 Agent</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">response</span> <span class="o">=</span> <span class="n">agent_executor</span><span class="o">.</span><span class="n">invoke</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;input&#34;</span><span class="p">:</span> <span class="s2">&#34;什么是 LangChain？它有哪些主要特性？&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">最终答案：&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s2">&#34;output&#34;</span><span class="p">])</span>
</span></span></code></pre></div><h3 id="进阶版本多工具-react-agent">进阶版本：多工具 React Agent</h3>
<p>让我们创建一个更强大的版本，包含多个工具：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_openai</span> <span class="kn">import</span> <span class="n">ChatOpenAI</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain.agents</span> <span class="kn">import</span> <span class="n">create_react_agent</span><span class="p">,</span> <span class="n">AgentExecutor</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain</span> <span class="kn">import</span> <span class="n">hub</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_community.tools</span> <span class="kn">import</span> <span class="n">DuckDuckGoSearchRun</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_experimental.tools</span> <span class="kn">import</span> <span class="n">PythonREPLTool</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_core.tools</span> <span class="kn">import</span> <span class="n">Tool</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 初始化语言模型（使用 DeepSeek）</span>
</span></span><span class="line"><span class="cl"><span class="n">llm</span> <span class="o">=</span> <span class="n">ChatOpenAI</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span><span class="o">=</span><span class="s2">&#34;deepseek-chat&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">api_key</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&#34;DEEPSEEK_API_KEY&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">base_url</span><span class="o">=</span><span class="s2">&#34;https://api.deepseek.com/v1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 定义自定义工具：获取当前时间</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_current_time</span><span class="p">(</span><span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;获取当前日期和时间&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="sa">f</span><span class="s2">&#34;当前时间：</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 定义自定义工具：计算器</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">calculator</span><span class="p">(</span><span class="n">expression</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;执行数学计算&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">result</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">expression</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="sa">f</span><span class="s2">&#34;计算结果：</span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="sa">f</span><span class="s2">&#34;计算错误：</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 创建工具列表</span>
</span></span><span class="line"><span class="cl"><span class="n">tools</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="n">DuckDuckGoSearchRun</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&#34;search&#34;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&#34;搜索互联网获取最新信息&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">PythonREPLTool</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&#34;python_repl&#34;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&#34;执行 Python 代码&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">Tool</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">name</span><span class="o">=</span><span class="s2">&#34;get_time&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">func</span><span class="o">=</span><span class="n">get_current_time</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">description</span><span class="o">=</span><span class="s2">&#34;获取当前日期和时间&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">Tool</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">name</span><span class="o">=</span><span class="s2">&#34;calculator&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">func</span><span class="o">=</span><span class="n">calculator</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">description</span><span class="o">=</span><span class="s2">&#34;执行数学计算，输入数学表达式&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 从 LangChain Hub 加载 React prompt</span>
</span></span><span class="line"><span class="cl"><span class="n">prompt</span> <span class="o">=</span> <span class="n">hub</span><span class="o">.</span><span class="n">pull</span><span class="p">(</span><span class="s2">&#34;hwchase17/react&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 创建 React Agent</span>
</span></span><span class="line"><span class="cl"><span class="n">agent</span> <span class="o">=</span> <span class="n">create_react_agent</span><span class="p">(</span><span class="n">llm</span><span class="p">,</span> <span class="n">tools</span><span class="p">,</span> <span class="n">prompt</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 创建 Agent 执行器</span>
</span></span><span class="line"><span class="cl"><span class="n">agent_executor</span> <span class="o">=</span> <span class="n">AgentExecutor</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">agent</span><span class="o">=</span><span class="n">agent</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">handle_parsing_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">max_iterations</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">max_execution_time</span><span class="o">=</span><span class="mi">60</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">run_agent</span><span class="p">(</span><span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;运行 Agent 并返回结果&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">response</span> <span class="o">=</span> <span class="n">agent_executor</span><span class="o">.</span><span class="n">invoke</span><span class="p">({</span><span class="s2">&#34;input&#34;</span><span class="p">:</span> <span class="n">query</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">response</span><span class="p">[</span><span class="s2">&#34;output&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="sa">f</span><span class="s2">&#34;执行错误：</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 示例 1：搜索信息</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;=&#34;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;示例 1：搜索信息&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;=&#34;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">result1</span> <span class="o">=</span> <span class="n">run_agent</span><span class="p">(</span><span class="s2">&#34;LangChain 1.0 版本有哪些新特性？&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">结果：</span><span class="si">{</span><span class="n">result1</span><span class="si">}</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># 示例 2：数学计算</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;=&#34;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;示例 2：数学计算&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;=&#34;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">result2</span> <span class="o">=</span> <span class="n">run_agent</span><span class="p">(</span><span class="s2">&#34;计算 (1234 * 5678) / 100 的结果&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">结果：</span><span class="si">{</span><span class="n">result2</span><span class="si">}</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># 示例 3：Python 代码执行</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;=&#34;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;示例 3：Python 代码执行&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;=&#34;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">result3</span> <span class="o">=</span> <span class="n">run_agent</span><span class="p">(</span><span class="s2">&#34;使用 Python 生成一个包含 10 个随机数的列表，并计算它们的平均值&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">结果：</span><span class="si">{</span><span class="n">result3</span><span class="si">}</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># 示例 4：综合任务</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;=&#34;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;示例 4：综合任务&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;=&#34;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">result4</span> <span class="o">=</span> <span class="n">run_agent</span><span class="p">(</span><span class="s2">&#34;今天是几号？然后搜索一下今天有什么重要的科技新闻&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">结果：</span><span class="si">{</span><span class="n">result4</span><span class="si">}</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="高级版本带记忆的-react-agent">高级版本：带记忆的 React Agent</h3>
<p>为了让 Agent 能够记住对话历史，我们可以添加记忆功能：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_openai</span> <span class="kn">import</span> <span class="n">ChatOpenAI</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain.agents</span> <span class="kn">import</span> <span class="n">create_react_agent</span><span class="p">,</span> <span class="n">AgentExecutor</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain</span> <span class="kn">import</span> <span class="n">hub</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_community.tools</span> <span class="kn">import</span> <span class="n">DuckDuckGoSearchRun</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_community.chat_message_histories</span> <span class="kn">import</span> <span class="n">ChatMessageHistory</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_core.chat_history</span> <span class="kn">import</span> <span class="n">BaseChatMessageHistory</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">langchain_core.runnables.history</span> <span class="kn">import</span> <span class="n">RunnableWithMessageHistory</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 初始化语言模型（使用 DeepSeek）</span>
</span></span><span class="line"><span class="cl"><span class="n">llm</span> <span class="o">=</span> <span class="n">ChatOpenAI</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span><span class="o">=</span><span class="s2">&#34;deepseek-chat&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">api_key</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&#34;DEEPSEEK_API_KEY&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">base_url</span><span class="o">=</span><span class="s2">&#34;https://api.deepseek.com/v1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 定义工具</span>
</span></span><span class="line"><span class="cl"><span class="n">tools</span> <span class="o">=</span> <span class="p">[</span><span class="n">DuckDuckGoSearchRun</span><span class="p">()]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 加载 React prompt</span>
</span></span><span class="line"><span class="cl"><span class="n">prompt</span> <span class="o">=</span> <span class="n">hub</span><span class="o">.</span><span class="n">pull</span><span class="p">(</span><span class="s2">&#34;hwchase17/react&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 创建 Agent</span>
</span></span><span class="line"><span class="cl"><span class="n">agent</span> <span class="o">=</span> <span class="n">create_react_agent</span><span class="p">(</span><span class="n">llm</span><span class="p">,</span> <span class="n">tools</span><span class="p">,</span> <span class="n">prompt</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 创建 Agent 执行器</span>
</span></span><span class="line"><span class="cl"><span class="n">agent_executor</span> <span class="o">=</span> <span class="n">AgentExecutor</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">agent</span><span class="o">=</span><span class="n">agent</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">handle_parsing_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 存储对话历史的字典</span>
</span></span><span class="line"><span class="cl"><span class="n">store</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_session_history</span><span class="p">(</span><span class="n">session_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BaseChatMessageHistory</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;获取或创建会话历史&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">session_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">store</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">store</span><span class="p">[</span><span class="n">session_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">ChatMessageHistory</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">store</span><span class="p">[</span><span class="n">session_id</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 创建带历史的 Agent</span>
</span></span><span class="line"><span class="cl"><span class="n">agent_with_history</span> <span class="o">=</span> <span class="n">RunnableWithMessageHistory</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">agent_executor</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">get_session_history</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">input_messages_key</span><span class="o">=</span><span class="s2">&#34;input&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">history_messages_key</span><span class="o">=</span><span class="s2">&#34;chat_history&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">session_id</span> <span class="o">=</span> <span class="s2">&#34;demo_session&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># 第一轮对话</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;=&#34;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;第一轮对话&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;=&#34;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">response1</span> <span class="o">=</span> <span class="n">agent_with_history</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span><span class="s2">&#34;input&#34;</span><span class="p">:</span> <span class="s2">&#34;我的名字是张三&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="n">config</span><span class="o">=</span><span class="p">{</span><span class="s2">&#34;configurable&#34;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;session_id&#34;</span><span class="p">:</span> <span class="n">session_id</span><span class="p">}}</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Agent: </span><span class="si">{</span><span class="n">response1</span><span class="p">[</span><span class="s1">&#39;output&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># 第二轮对话（Agent 应该记得名字）</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;=&#34;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;第二轮对话&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;=&#34;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">response2</span> <span class="o">=</span> <span class="n">agent_with_history</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span><span class="s2">&#34;input&#34;</span><span class="p">:</span> <span class="s2">&#34;我的名字是什么？&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="n">config</span><span class="o">=</span><span class="p">{</span><span class="s2">&#34;configurable&#34;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;session_id&#34;</span><span class="p">:</span> <span class="n">session_id</span><span class="p">}}</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Agent: </span><span class="si">{</span><span class="n">response2</span><span class="p">[</span><span class="s1">&#39;output&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span></code></pre></div><h2 id="react-agent-的工作原理">React Agent 的工作原理</h2>
<h3 id="1-prompt-结构">1. Prompt 结构</h3>
<p>React Agent 使用的 prompt 模板包含以下部分：</p>
<ul>
<li><strong>系统指令</strong>：告诉 Agent 如何思考和行动</li>
<li><strong>工具描述</strong>：列出可用的工具及其使用方法</li>
<li><strong>示例</strong>：展示如何格式化和使用工具</li>
<li><strong>思考-行动-观察循环</strong>：指导 Agent 的执行流程</li>
</ul>
<h3 id="2-执行流程">2. 执行流程</h3>
<pre tabindex="0"><code>用户输入
    ↓
Agent 推理（思考需要做什么）
    ↓
选择工具并调用
    ↓
观察工具执行结果
    ↓
基于结果继续推理
    ↓
（如果需要）再次调用工具
    ↓
给出最终答案
</code></pre><h3 id="3-工具调用格式">3. 工具调用格式</h3>
<p>Agent 使用特定的格式来调用工具：</p>
<pre tabindex="0"><code>Thought: 我需要搜索信息
Action: search
Action Input: LangChain 1.0 features
Observation: [工具返回的结果]
Thought: 基于搜索结果，我可以给出答案
Final Answer: LangChain 1.0 的主要特性包括...
</code></pre><h2 id="实际应用场景">实际应用场景</h2>
<h3 id="1-信息检索和问答">1. 信息检索和问答</h3>
<p>Agent 可以搜索最新信息并回答用户问题：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">query</span> <span class="o">=</span> <span class="s2">&#34;2024 年 AI 领域有哪些重要突破？&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">response</span> <span class="o">=</span> <span class="n">agent_executor</span><span class="o">.</span><span class="n">invoke</span><span class="p">({</span><span class="s2">&#34;input&#34;</span><span class="p">:</span> <span class="n">query</span><span class="p">})</span>
</span></span></code></pre></div><h3 id="2-数据分析">2. 数据分析</h3>
<p>结合 Python REPL 工具，Agent 可以执行数据分析任务：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">query</span> <span class="o">=</span> <span class="s2">&#34;分析这个 CSV 文件，找出销售额最高的产品类别&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">response</span> <span class="o">=</span> <span class="n">agent_executor</span><span class="o">.</span><span class="n">invoke</span><span class="p">({</span><span class="s2">&#34;input&#34;</span><span class="p">:</span> <span class="n">query</span><span class="p">})</span>
</span></span></code></pre></div><h3 id="3-代码生成和执行">3. 代码生成和执行</h3>
<p>Agent 可以生成代码并执行：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">query</span> <span class="o">=</span> <span class="s2">&#34;写一个 Python 函数来计算斐波那契数列的第 n 项，并测试 n=10 的情况&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">response</span> <span class="o">=</span> <span class="n">agent_executor</span><span class="o">.</span><span class="n">invoke</span><span class="p">({</span><span class="s2">&#34;input&#34;</span><span class="p">:</span> <span class="n">query</span><span class="p">})</span>
</span></span></code></pre></div><h3 id="4-多步骤任务规划">4. 多步骤任务规划</h3>
<p>Agent 可以规划并执行复杂的多步骤任务：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">query</span> <span class="o">=</span> <span class="s2">&#34;先搜索今天的天气，然后根据天气情况推荐合适的活动&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">response</span> <span class="o">=</span> <span class="n">agent_executor</span><span class="o">.</span><span class="n">invoke</span><span class="p">({</span><span class="s2">&#34;input&#34;</span><span class="p">:</span> <span class="n">query</span><span class="p">})</span>
</span></span></code></pre></div><h2 id="最佳实践">最佳实践</h2>
<h3 id="1-工具设计">1. 工具设计</h3>
<ul>
<li><strong>清晰的描述</strong>：为每个工具提供清晰、详细的描述</li>
<li><strong>合适的粒度</strong>：工具应该专注于单一功能</li>
<li><strong>错误处理</strong>：确保工具能够优雅地处理错误</li>
</ul>
<h3 id="2-prompt-优化">2. Prompt 优化</h3>
<ul>
<li><strong>明确的指令</strong>：告诉 Agent 何时使用工具，何时给出最终答案</li>
<li><strong>示例引导</strong>：提供好的示例来引导 Agent 的行为</li>
<li><strong>约束设置</strong>：设置合理的迭代次数和执行时间限制</li>
</ul>
<h3 id="3-错误处理">3. 错误处理</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">agent_executor</span> <span class="o">=</span> <span class="n">AgentExecutor</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">agent</span><span class="o">=</span><span class="n">agent</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">handle_parsing_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># 处理解析错误</span>
</span></span><span class="line"><span class="cl">    <span class="n">max_iterations</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>            <span class="c1"># 限制最大迭代次数</span>
</span></span><span class="line"><span class="cl">    <span class="n">max_execution_time</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>        <span class="c1"># 限制最大执行时间</span>
</span></span><span class="line"><span class="cl">    <span class="n">return_intermediate_steps</span><span class="o">=</span><span class="kc">True</span>  <span class="c1"># 返回中间步骤</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></div><h3 id="4-调试技巧">4. 调试技巧</h3>
<ul>
<li>启用 <code>verbose=True</code> 查看详细的执行过程</li>
<li>使用 <code>return_intermediate_steps=True</code> 获取中间步骤</li>
<li>检查工具的输出是否符合预期</li>
</ul>
<h2 id="常见问题">常见问题</h2>
<h3 id="1-agent-陷入循环">1. Agent 陷入循环</h3>
<p><strong>问题</strong>：Agent 反复调用同一个工具，无法完成任务</p>
<p><strong>解决方案</strong>：</p>
<ul>
<li>设置 <code>max_iterations</code> 限制迭代次数</li>
<li>改进工具描述，让 Agent 更清楚何时停止</li>
<li>优化 prompt，明确告诉 Agent 何时给出最终答案</li>
</ul>
<h3 id="2-工具调用失败">2. 工具调用失败</h3>
<p><strong>问题</strong>：Agent 调用工具时出现错误</p>
<p><strong>解决方案</strong>：</p>
<ul>
<li>检查工具的参数格式是否正确</li>
<li>添加 <code>handle_parsing_errors=True</code> 处理解析错误</li>
<li>在工具函数中添加错误处理逻辑</li>
</ul>
<h3 id="3-成本控制">3. 成本控制</h3>
<p><strong>问题</strong>：Agent 调用 LLM 和工具产生较高成本</p>
<p><strong>解决方案</strong>：</p>
<ul>
<li>设置 <code>max_iterations</code> 限制</li>
<li>使用更便宜的模型（如 deepseek-chat）</li>
<li>缓存工具调用结果</li>
<li>优化 prompt 减少不必要的推理步骤</li>
</ul>
<h2 id="总结">总结</h2>
<p>LangChain 1.0 的 React Agent 提供了一个强大而灵活的框架来构建智能代理。通过结合推理和行动，Agent 能够：</p>
<ul>
<li>理解复杂的用户需求</li>
<li>规划多步骤任务</li>
<li>调用工具获取信息或执行操作</li>
<li>基于结果进行推理并给出答案</li>
</ul>
<p>本文提供了从基础到高级的完整示例，你可以根据自己的需求进行扩展和定制。React Agent 的强大之处在于它的灵活性——通过添加不同的工具，你可以构建出各种不同用途的智能代理。</p>
<h2 id="参考资源">参考资源</h2>
<ul>
<li><a href="https://python.langchain.com/">LangChain 官方文档</a></li>
<li><a href="https://smith.langchain.com/hub">LangChain Hub</a></li>
<li><a href="https://arxiv.org/abs/2210.03629">React Agent 论文</a></li>
<li><a href="https://github.com/langchain-ai/langchain">LangChain GitHub</a></li>
</ul>
<hr>
<p>希望这个 Demo 能帮助你理解和使用 LangChain 1.0 的 React Agent。如果你有任何问题或建议，欢迎交流讨论！</p>
</article>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>
<script type="application/javascript" src='https://deqinglv.github.io/blog/js/toc.js'></script>
<link rel="stylesheet" href='https://deqinglv.github.io/blog/css/toc.css' />

  
</div>

  <div class="footer container-xl width-full p-responsive">
  <div
    class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between flex-sm-items-center pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light ">
    <a aria-label="Homepage" title="GitHub" class="footer-octicon d-none d-lg-block mr-lg-4" href="https://deqinglv.github.io/blog/">
      <svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="24">
        <path fill-rule="evenodd"
          d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
        </path>
      </svg>
    </a>
    <ul class="list-style-none d-flex flex-wrap col-12 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0">
      
      <li class="mr-3 mr-lg-0">Theme by <a href='https://github.com/MeiK2333/github-style'>github-style</a></li>
      
      <li class="mr-3 mr-lg-0">GitHub and the Invertocat logo are trademarks of <a href="https://github.com/">GitHub, Inc.</a></li>
    </ul>
  </div>
  <div class="d-flex flex-justify-center pb-6">
    <span class="f6 text-gray-light"></span>
  </div>


</div>

</body>

<script type="application/javascript" src="https://deqinglv.github.io/blog/js/github-style.js"></script>





<script src="https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.min.js"></script>
<script type="application/javascript" src='https://deqinglv.github.io/blog/js/search.js'></script>



</html>